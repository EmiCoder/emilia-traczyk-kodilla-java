CREATE VIEW BESTSELLERS_COUNT AS SELECT 
COUNT(*) AS BESTSELLERS_AMOUNT FROM BOOKS
WHERE BESTSELLER = "true";

DELIMITER $$

CREATE EVENT UPDATE_BESTSELLERS_COUNT
	ON SCHEDULE EVERY 1 MINUTE
    DO 
		BEGIN
			CALL UpdateBestsellers();
			INSERT INTO STATS (STAT_DATE, STAT, VALUE) VALUES (CURRENT_TIMESTAMP, "Bestsellers", (SELECT * FROM BESTSELLERS_COUNT));
            COMMIT;
		END $$
        
DELIMITER ;

drop event UPDATE_BESTSELLERS_COUNT;

